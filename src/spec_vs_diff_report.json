{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-14T15:47:45.989Z",
  "summary": "Frontend error state now includes a Retry control that refetches schools while preserving the exact existing error message. Backend changes add a migration module that seeds demo schools on upgrade in an idempotent way, but the diff is truncated for `searchSchoolsByName`, and there is no clear evidence that demo data is guaranteed after a fresh install (pre-upgrade) or that `searchSchoolsByName(\"\")` is made non-trapping/non-rejecting for anonymous users.",
  "missing_requirements": [
    {
      "id": "REQ-45",
      "requirement": "Fix the backend `searchSchoolsByName(\"\")` path so it never traps/rejects for anonymous users and consistently returns a `[School]` (possibly empty), returning `[]` when no schools exist.",
      "reason": "The diff for `backend/main.mo` is truncated right as `searchSchoolsByName` begins, so there is no visible implementation showing that the empty-string search path is handled safely (no trap/reject) and returns an array for anonymous callers.",
      "evidence": [
        "backend/main.mo (searchSchoolsByName section is truncated)"
      ]
    },
    {
      "id": "REQ-46",
      "requirement": "Ensure idempotent demo/seed data exists immediately after installation and after upgrades so Directory loads a non-empty school list by default; seeding must be safe to run multiple times and discoverable via `searchSchoolsByName(\"\")`.",
      "reason": "`backend/migration.mo` only shows seeding in a migration `run(old)` function (upgrade path). In `backend/main.mo`, the maps are initialized empty (`Map.empty`) with no visible install-time seeding logic in the provided excerpt, so there is no clear evidence that a fresh deploy (no prior state/upgrade) will have non-empty schools by default.",
      "evidence": [
        "backend/migration.mo (seeding occurs in Migration.run old->new)",
        "backend/main.mo (initializes `schools` as `Map.empty`, no install seeding shown in excerpt)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Large set of additional frontend UI/theme and feature changes unrelated to making school loading reliable (e.g., SchoolDetailPage sections like map/gallery/FAQ/similar schools; global theme/background changes; multiple new hooks/components).",
      "reason": "The BuildRequest explicitly focuses on fixing school loading reliability and adding a retry control; it lists non-goals including unrelated directory features. The diff summary indicates many broader UI/features beyond those requirements.",
      "evidence": [
        "frontend-file-summaries.txt (describes extensive additions/changes across many pages/components beyond retry control)"
      ]
    }
  ],
  "confidence": 0.64,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/pages/DirectoryPage.tsx",
    "project_state.json"
  ]
}